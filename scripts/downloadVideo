season=$1
episode=$2
paddedEpisode=`printf %02d $episode`
language=$3
url=$4
mkdir -p build
if [ ! -f build/ertugrul-$season-$paddedEpisode-en.vtt ]; then
    yt-dlp --all-subs --skip-download --user-agent "Mozilla/5.0" --sleep-requests 1 $url
    if [ $language == "tr" ]; then
        mv Resurrection\ Ertugrul\ Season\ $season\ Episode\ $episode-*.vtt build/ertugrul-$season-$paddedEpisode-en.vtt
    fi
fi
if [ ! -f build/ertugrul-$season-$paddedEpisode-$language.jpg ]; then
    yt-dlp --write-thumbnail --skip-download --user-agent "Mozilla/5.0" --sleep-requests 1 $url
    if [ $language == "tr" ]; then
        mv Resurrection\ Ertugrul\ Season\ $season\ Episode\ $episode-*.jpg build/ertugrul-$season-$paddedEpisode-$language.jpg
    elif [  $language == "ar" ]; then
        mv *\ $episode*.jpg build/ertugrul-$season-$paddedEpisode-$language.jpg
    fi
fi
if [ ! -f build/ertugrul-$season-$paddedEpisode-$language.m4a ]; then
    yt-dlp -f 'bestaudio[ext=m4a]/bestaudio/best' --extract-audio --audio-format m4a --user-agent "Mozilla/5.0" --sleep-requests 1 $url
    if [ $language == "tr" ]; then
        mv Resurrection\ Ertugrul\ Season\ $season\ Episode\ $episode-*.m4a build/ertugrul-$season-$paddedEpisode-$language.m4a
    elif [  $language == "ar" ]; then
        mv *\ $episode*.m4a build/ertugrul-$season-$paddedEpisode-$language.m4a
    fi
fi
if [ ! -f build/ertugrul-$season-$paddedEpisode-$language.mp4 ]; then
    echo downloadVideo $url
    yt-dlp -f 'best[height<=720][ext=mp4]/best[ext=mp4]/best' --merge-output-format mp4 --user-agent "Mozilla/5.0" --sleep-requests 1 $url
    
    if [ -f *\ $episode-*.mkv ]; then
        handbrakecli -i *\ $episode-*.mkv -o build/ertugrul-$season-$paddedEpisode-$language.mp4
        rm *\ $episode-*.mkv
    elif [ -f *\ $episode-*.webm ]; then
        handbrakecli -i *\ $episode-*.webm -o build/ertugrul-$season-$paddedEpisode-$language.mp4
        rm *\ $episode-*.webm
    else
        mv *\ $episode*.mp4 build/ertugrul-$season-$paddedEpisode-$language.mp4
    fi
fi
